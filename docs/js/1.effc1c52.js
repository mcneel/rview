(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"8b24":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"flex flex-center",attrs:{id:"canvasParent"}},[e.viewmodel.docExists?e._e():n("q-card",{attrs:{flat:""}},[n("q-img",{attrs:{alt:"rview",src:"statics/logo.png"}}),n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("rview WIP")])])],1),e.viewmodel.docExists?n("q-page-sticky",{attrs:{position:"bottom-left",offset:[10,10]}},[n("q-fab",{attrs:{color:"primary",icon:"keyboard_arrow_up",direction:"up"}},[n("q-fab-action",{attrs:{color:e.panMode?"secondary":"primary",icon:"pan_tool"},on:{click:function(t){return e.togglePan()}}},[n("q-tooltip",{attrs:{"transition-show":"flip-right","transition-hide":"flip-left"}},[e._v("\n          Pan\n        ")])],1),n("q-fab-action",{attrs:{color:"primary",icon:"zoom_out_map"},on:{click:function(t){return e.zoomExtents()}}},[n("q-tooltip",{attrs:{"transition-show":"flip-right","transition-hide":"flip-left"}},[e._v("\n          Zoom Extents\n        ")])],1),e.viewmodel.perspectiveCamera?n("q-fab-action",{attrs:{color:"primary",icon:"img:statics/icons/3D.svg"},on:{click:function(t){return e.setProjection(!1)}}}):e._e(),e.viewmodel.perspectiveCamera?e._e():n("q-fab-action",{attrs:{color:"primary",icon:"img:statics/icons/2D.svg"},on:{click:function(t){return e.setProjection(!0)}}})],1)],1):e._e(),e.panMode?n("q-page-sticky",{attrs:{position:"bottom-right",offset:[10,10]}},[n("q-btn",{attrs:{outline:"",rounded:"",color:"primary",label:"Pan Mode","icon-right":"close"},on:{click:function(t){return e.togglePan()}}})],1):e._e()],1)},o=[],a=n("967e"),i=n.n(a),c=(n("34ef"),n("96cf"),n("fa84")),s=n.n(c),l=(n("28a5"),n("5a89")),d=n("4721"),u=n("1bee");n("63d9");function h(e,t){var n=u["a"].getRhino3dm(),r=t,o=[];if(e instanceof n.LineCurve)return[e.pointAtStart,e.pointAtEnd];if(e instanceof n.PolylineCurve){r=e.pointCount;for(var a=0;a<r;a++)o.push(e.point(a));return o}if(e instanceof n.PolyCurve){for(var i=e.segmentCount,c=0;c<i;c++){var s=e.segmentCurve(c),l=h(s);o=o.concat(l),s.delete()}return o}e instanceof n.NurbsCurve&&1===e.degree&&console.info("degree 1 curve");for(var d=e.domain,p=r-1,m=0;m<r;m++){var f=d[0]+m/p*(d[1]-d[0]);o.push(e.pointAt(f))}return o}var p={createGrid:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:70,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=-t*e,o=r,a=t*e,i=a,c=new l["n"],s=[],d=[],u=-t;u<=t;u++){var h=u*e,p=u*e;0!==u?u%n===0?(d.push(new l["J"](h,o,0)),d.push(new l["J"](h,i,0)),d.push(new l["J"](r,p,0)),d.push(new l["J"](a,p,0))):(s.push(new l["J"](h,o,0)),s.push(new l["J"](h,i,0)),s.push(new l["J"](r,p,0)),s.push(new l["J"](a,p,0))):(d.push(new l["J"](0,o,0)),d.push(new l["J"](0,0,0)),d.push(new l["J"](r,0,0)),d.push(new l["J"](0,0,0)))}for(var m=new l["p"]({color:1118481,depthTest:!1,depthWrite:!1}),f=new Float32Array(3*d.length),v=0;v<d.length;v++)f[3*v]=d[v].x,f[3*v+1]=d[v].y,f[3*v+2]=d[v].z;var g=new l["c"];g.setAttribute("position",new l["b"](f,3));var w=new l["q"](g,m),b=new l["p"]({color:7829367,depthTest:!1,depthWrite:!1});f=new Float32Array(3*s.length);for(var y=0;y<s.length;y++)f[3*y]=s[y].x,f[3*y+1]=s[y].y,f[3*y+2]=s[y].z;g=new l["c"],g.setAttribute("position",new l["b"](f,3));var x=new l["q"](g,b);c.add(w),c.add(x),f=new Float32Array([0,0,0,a,0,0]),g=new l["c"],g.setAttribute("position",new l["b"](f,3));var T=new l["p"]({color:new l["f"](150/255,75/255,75/255),depthTest:!1,depthWrite:!1});c.add(new l["q"](g,T)),f=new Float32Array([0,0,0,0,i,0]),g=new l["c"],g.setAttribute("position",new l["b"](f,3));var O=new l["p"]({color:new l["f"](75/255,150/255,75/255),depthTest:!1,depthWrite:!1});return c.add(new l["q"](g,O)),c},curveToBufferGeometry:function(e,t){for(var n=h(e,t),r=new l["c"],o=new Float32Array(3*n.length),a=0;a<n.length;a++)o[3*a]=n[a][0],o[3*a+1]=n[a][1],o[3*a+2]=n[a][2];return r.setAttribute("position",new l["b"](o,3)),r},meshToThreejs:function(e,t){var n=new l["d"],r=n.parse(e.toThreejsJSON());0===t.r&&0===t.g&&0===t.b&&(t.r=255,t.g=255,t.b=255);var o=new l["f"](t.r/255,t.g/255,t.b/255),a=new l["x"]({color:o,side:l["i"]});return new l["w"](r,a)},createThreeGeometry:function(e,t,n){var r=this,o=u["a"].getRhino3dm(),a=[],i=e.objectType;switch(i){case o.ObjectType.Point:var c=new l["D"]({color:t}),s=new l["m"],d=e.location;s.vertices.push(new l["J"](d[0],d[1],d[2])),a.push([new l["C"](s,c),e.getBoundingBox()]);break;case o.ObjectType.PointSet:for(var h=new l["D"]({color:t}),p=new l["m"],m=e.count,f=0;f<m;f++){var v=e.pointAt(f);p.vertices.push(new l["J"](v[0],v[1],v[2]))}a.push([new l["C"](p,h),e.getBoundingBox()]);break;case o.ObjectType.Curve:var g=this.curveToBufferGeometry(e,32),w=new l["f"](t.r/255,t.g/255,t.b/255),b=new l["p"]({color:w}),y=new l["o"](g,b);a.push([y,e.getBoundingBox()]);break;case o.ObjectType.Surface:console.warn("TODO: Implement surface");break;case o.ObjectType.Brep:for(var x=e.faces(),T=0;T<x.count;T++){var O=x.get(T),j=O.getMesh(o.MeshType.Any);if(j){var k=this.meshToThreejs(j,t);a.push([k,j.getBoundingBox()]),j.delete()}O.delete()}x.delete();break;case o.ObjectType.Mesh:var C=this.meshToThreejs(e,t);a.push([C,e.getBoundingBox()]);break;case o.ObjectType.Light:console.warn("TODO: Implement light");break;case o.ObjectType.Annotation:console.warn("TODO: Implement annotation");break;case o.ObjectType.InstanceReference:var A=e.parentIdefId,B=e.xform.toFloatArray(!0),P=new l["n"],E=new l["v"];E.set(B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15]),P.applyMatrix(E),a.push([P,null]);var M=n.instanceDefinitions(),q=n.objects(),z=M.findId(A),I=z.getObjectIds();I.forEach((function(e){var t=q.findId(e),o=t.geometry(),a=t.attributes(),i=a.drawColor(n),c=r.createThreeGeometry(o,i,n);c.forEach((function(e){P.add(e[0])}))})),q.delete(),M.delete();break;case o.ObjectType.TextDot:console.warn("TODO: Implement dot");break;case o.ObjectType.Hatch:console.warn("TODO: Implement hatch");break;case o.ObjectType.SubD:console.warn("TODO: Implement SubD");break;case o.ObjectType.ClipPlane:console.warn("TODO: Implement clipplane");break;case o.ObjectType.Extrusion:var D=e.getMesh(o.MeshType.Any);if(D){var J=this.meshToThreejs(D,t);a.push([J,D.getBoundingBox()]),D.delete()}break;default:break}return a}},m=p,f={renderer:null,camera:null,controls:null,initialize:function(){if(null==this.renderer){l["z"].DefaultUp=new l["J"](0,0,1),this.renderer=new l["L"]({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio);var e=document.getElementById("canvasParent");this.renderer.setSize(e.clientWidth,e.clientHeight),e.appendChild(this.renderer.domElement),window.addEventListener("resize",(function(){return v(!0)}),!1),this.camera=new l["B"](30,e.clientWidth/e.clientHeight,1,1e3),this.camera.position.z=40,this.controls=new d["a"](this.camera,this.renderer.domElement),this.controls.screenSpacePanning=!0}},zoomExtents:function(e){var t=u["a"].getRhino3dm(),n=u["a"].viewModel().perspectiveCamera?t.ViewportInfo.defaultPerspective():t.ViewportInfo.defaultTop(),r=new l["I"](0,0);f.renderer.getSize(r),n.screenPort=[0,0,r.x,r.y];var o=u["a"].visibleObjectsBoundingBox(),a=new t.BoundingBox(o.min.x,o.min.y,o.min.z,o.max.x,o.max.y,o.max.z),i=a.center,c=a.max[0]-a.min[0],s=a.max[1]-a.min[1],d=a.max[2]-a.min[2];a.inflate(.2*c,.2*s,.2*d);var h=c,p=h*r.y/r.x;if(n.setFrustum(-h/2,h/2,-p/2,p/2,.1,1e3),n.extents(157.0795/180,a),a.delete(),e){u["a"].getActiveModel().three.middleground.remove(this.camera);var m=n.getFrustum();u["a"].viewModel().perspectiveCamera?this.camera=new l["B"](30,r.x/r.y,1,1e3):(this.camera=new l["A"](m.left,m.right,m.top,m.bottom,m.near,m.far),this.camera.up.set(n.cameraUp[0],n.cameraUp[1],n.cameraUp[2])),this.controls.object=this.camera;var v=new l["h"](u["a"].viewModel().lightColor);v.position.set(0,0,1),u["a"].getActiveModel().cameraLight=v,this.camera.add(v),u["a"].getActiveModel().three.middleground.add(this.camera)}var g=n.cameraLocation;this.camera.position.set(g[0],g[1],g[2]),this.camera.updateProjectionMatrix(),this.controls.target.set(i[0],i[1],i[2]),n.delete()}},v=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t){var n=document.getElementById("canvasParent");f.camera.aspect=n.clientWidth/n.clientHeight,f.camera.updateProjectionMatrix(),f.renderer.setSize(n.clientWidth,n.clientHeight)}requestAnimationFrame(e),f.controls.update();var r=u["a"].getActiveModel();f.renderer.autoClear=!1,f.renderer.render(r.three.background,f.camera),f.renderer.render(r.three.middleground,f.camera)};function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n||r||(e.background=new l["f"](t)),t&&n){var o=document.createElement("canvas");o.width=128,o.height=128;var a=o.getContext("2d"),i=a.createLinearGradient(0,0,0,o.height);i.addColorStop(1,n),i.addColorStop(.1,t),a.fillStyle=i,a.fillRect(0,0,o.width,o.height),e.background=new l["e"](o)}if(r){var c=new l["g"];c.setPath("statics/cubemaps/"+r+"/");var s=c.load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"]);e.background=s,v(!0)}}function w(){f.initialize(),u["a"].disposeMiddleground();var e=u["a"].getActiveModel();if(e.three.middleground=new l["F"],null==e.three.background){e.three.background=new l["F"],e.three.background.background=new l["f"](.75,.75,.75);var t=m.createGrid();e.threeGrid=t,e.three.background.add(t)}e.three.setBackground=g}function b(){console.log("Building Scene"),w();for(var e=u["a"].getActiveModel(),t=e.rhinoDoc,n=t.objects(),r=function(r){var o=n.get(r);if(null==o)return"continue";var a=o.geometry(),i=o.attributes();if(i.isInstanceDefinitionObject)return"continue";var c=t.layers().get(i.layerIndex),s=c.fullPath.split("::")[0];e.threeObjectsOnLayer[s]||(e.threeObjectsOnLayer[s]=[]);var d=i.drawColor(t),u=m.createThreeGeometry(a,d,t);u.forEach((function(t){var n=t[0],r=t[1];if(r){var o=new l["J"](r.min[0],r.min[1],r.min[2]),a=new l["J"](r.max[0],r.max[1],r.max[2]);n.boundingBox=new l["a"](o,a),r.delete()}e.three.middleground.add(n),e.threeObjectsOnLayer[s].push(n)})),o.delete(),a.delete(),i.delete()},o=0;o<n.count;o++)r(o);n.delete(),u["a"].updateVisibility(),f.zoomExtents(!0),v()}var y={data:function(){var e=u["a"].viewModel();return{panMode:!1,viewmodel:e}},props:{url:{type:String,default:""}},created:function(){u["a"].addActiveDocChangedEventWatcher(b),this.viewmodel.onChangeCamera=this.updateCameraProjection},mounted:function(){this.$route.query&&this.$route.query["url"]&&(console.log("MOUNTED with "+this.$route.query["url"]),this.openURL(this.$route.query["url"])),console.log("MOUNTED")},watch:{$route:function(e,t){e.query["url"]&&this.openURL(e.query["url"]),console.log(e.query)}},methods:{openURL:function(e){fetch(e).then(function(){var t=s()(i.a.mark((function t(n){var r,o;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.arrayBuffer();case 2:r=t.sent,o=new Uint8Array(r),u["a"].openFile(e,o);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},updateCameraProjection:function(){f.zoomExtents(!0),this.setLeftButtonMode()},zoomExtents:function(){f.zoomExtents(!0)},togglePan:function(){this.panMode=!this.panMode,this.setLeftButtonMode()},setProjection:function(e){this.viewmodel.perspectiveCamera!==e&&(this.viewmodel.perspectiveCamera=e,this.updateCameraProjection(),this.zoomExtents())},setLeftButtonMode:function(){this.panMode||!this.viewmodel.perspectiveCamera?(f.controls.mouseButtons.LEFT=l["t"].PAN,f.controls.touches.ONE=l["H"].PAN):(f.controls.mouseButtons.LEFT=l["t"].ROTATE,f.controls.touches.ONE=l["H"].ROTATE)}}},x=y,T=n("2877"),O=n("eebe"),j=n.n(O),k=n("9989"),C=n("f09f"),A=n("068f"),B=n("a370"),P=n("de5e"),E=n("c294"),M=n("72db"),q=n("05c0"),z=n("9c40"),I=Object(T["a"])(x,r,o,!1,null,null,null);t["default"]=I.exports;j()(I,"components",{QPage:k["a"],QCard:C["a"],QImg:A["a"],QCardSection:B["a"],QPageSticky:P["a"],QFab:E["a"],QFabAction:M["a"],QTooltip:q["a"],QBtn:z["a"]})}}]);