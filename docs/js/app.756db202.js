(function(e){function t(t){for(var i,o,l=t[0],a=t[1],c=t[2],d=0,u=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&u.push(r[o][0]),r[o]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i]);h&&h(t);while(u.length)u.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,o=1;o<n.length;o++){var a=n[o];0!==r[a]&&(i=!1)}i&&(s.splice(t--,1),e=l(l.s=n[0]))}return e}var i={},r={2:0},s=[];function o(e){return l.p+"js/"+({}[e]||e)+"."+{1:"8fce0b4c",3:"ef8bbca0",4:"6a824c62"}[e]+".js"}function l(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=i);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,l.nc&&a.setAttribute("nonce",l.nc),a.src=o(e);var c=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(d);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",c.name="ChunkLoadError",c.type=i,c.request=s,n[1](c)}r[e]=void 0}};var d=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},l.m=e,l.c=i,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(n,i,function(t){return e[t]}.bind(null,i));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e};var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var d=0;d<a.length;d++)t(a[d]);var h=c;s.push([0,0]),n()})({0:function(e,t,n){e.exports=n("2f39")},"0047":function(e,t,n){},"2f39":function(e,t,n){"use strict";n.r(t);var i=n("c973"),r=n.n(i),s=(n("7d6e"),n("e54f"),n("985d"),n("0047"),n("2b0e")),o=n("1f91"),l=n("42d2"),a=n("b05d"),c=n("f508");s["a"].use(a["a"],{config:{loading:{}},lang:o["a"],iconSet:l["a"],plugins:{Loading:c["a"]}});var d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"q-app"}},[n("router-view")],1)},h=[],u=n("436a"),p={name:"App",mounted:function(){u["a"].init(window.rhino3dm,this.showLoading,this.hideLoading)},methods:{showLoading(){this.$q.loading.show()},hideLoading(){this.$q.loading.hide()}}},f=p,m=n("2877"),g=Object(m["a"])(f,d,h,!1,null,null,null),y=g.exports,w=n("8c4f");n("e6cf");const b=[{path:"/",component:()=>Promise.all([n.e(0),n.e(4)]).then(n.bind(null,"713b")),children:[{path:"",component:()=>Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"8b24"))},{path:"/view",component:()=>Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"8b24")),props:e=>({query:e.query.q})}]}];b.push({path:"*",component:()=>Promise.all([n.e(0),n.e(3)]).then(n.bind(null,"e51e"))});var _=b;s["a"].use(w["a"]);var v=function(){const e=new w["a"]({scrollBehavior:()=>({x:0,y:0}),routes:_,mode:"hash",base:""});return e},x=function(){return M.apply(this,arguments)};function M(){return M=r()((function*(){const e="function"===typeof v?yield v({Vue:s["a"]}):v,t={router:e,render:e=>e(y),el:"#q-app"};return{app:t,router:e}})),M.apply(this,arguments)}function T(){return P.apply(this,arguments)}function P(){return P=r()((function*(){const{app:e,router:t}=yield x();new s["a"](e)})),P.apply(this,arguments)}T()},"436a":function(e,t,n){"use strict";n.d(t,"a",(function(){return ne}));var i=n("de5e"),r=n.n(i),s=n("95ee"),o=n.n(s),l=n("5a89"),a=(n("fb6a"),n("ace4"),n("cfc3"),n("aea1"));n("fd87");function c(e){let t=new l["c"],n=new Float32Array(3*e._starts.length);for(let l=0;l<e._starts.length;l++)n[3*l]=e._starts[l].x,n[3*l+1]=e._starts[l].y,n[3*l+2]=e._starts[l].z;if(t.setAttribute("position",new l["b"](n,3)),e._canBeLineSegments)return t;let i=new Float32Array(3*e._ends.length);for(let l=0;l<e._ends.length;l++)i[3*l]=e._ends[l].x,i[3*l+1]=e._ends[l].y,i[3*l+2]=e._ends[l].z;t.setAttribute("end",new l["b"](i,3));let r=new Float32Array(e._thicknesses.length);for(let l=0;l<e._thicknesses.length;l++)r[l]=e._thicknesses[l];t.setAttribute("thickness",new l["b"](r,1));let s=new Int8Array(e._sides.length);for(let l=0;l<e._sides.length;l++)s[l]=e._sides[l];t.setAttribute("side",new l["b"](s,1));let o=new Float32Array(4*e._colors.length);for(let l=0;l<e._colors.length;l++)o[4*l]=e._colors[l].r,o[4*l+1]=e._colors[l].g,o[4*l+2]=e._colors[l].b,o[4*l+3]=1;return t.setAttribute("color",new l["b"](o,4)),t.setIndex(e._indices),t}function d(e,t){let n="\nvoid main() {\n  vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n  vec4 clip = projectionMatrix * modelViewPosition;\n#ifdef NO_CLIP_Z\n  clip.z = 0.0;\n#else\n  float z = clip_position.z / clip_position.w;\n  z -= 0.001;\n  clip_position.z = z * clip_position.w;\n#endif\n  gl_Position = clip;\n}\n",i="\nuniform vec3 color;\nvoid main() {\n  gl_FragColor = vec4(color.rgb, 1.0);\n}\n";e&&(n="#define NO_CLIP_Z\n    "+n,i="#define NO_CLIP_Z\n    "+i);let r=new l["H"]({uniforms:{color:{type:"vec3",value:t}},vertexShader:n,fragmentShader:i,depthWrite:!e,depthTest:!e});return r}function h(e){let t="\nuniform vec2 viewport_size;\n\nattribute vec3 end;\nattribute float thickness;\nattribute float side;\nattribute vec4 color;\n\nvarying vec4 fs_color;\n\nvec2 ClipToScreen(in vec4 clip)\n{\n  float x = viewport_size.x * (1.0 + clip.x / clip.w) * 0.5;\n  float y = viewport_size.y * (1.0 + clip.y / clip.w) * 0.5;\n  return vec2(x, y);\n}\n\nvec2 ScreenToClip(in vec2 screen)\n{\n  float x = 2.0 * screen.x / viewport_size.x - 1.0;\n  float y = 2.0 * screen.y / viewport_size.y - 1.0;\n  return vec2(x, y);\n}\n\nvec2 RotatePoint90(in vec2 p, in bool ccw, in vec2 center)\n{\n  float s = ccw ? -1.0 : 1.0;\n  \n  // translate point back to origin:\n  p = p - center;\n  \n  // rotate point\n  float xnew = -p.y * s;\n  float ynew = p.x * s;\n  \n  // translate point back:\n  p.x = xnew + center.x;\n  p.y = ynew + center.y;\n  return p;\n}\n\n// Helper constants and types for 4D homogeneous drawing routines...\nconst int XLO = 1;\nconst int XHI = 2;\nconst int YLO = 4;\nconst int YHI = 8;\nconst int ZLO = 16;\nconst int ZHI = 32;\n\nvec3 ClippingSideFlag(in vec4 q)\n{\n  vec3 side = vec3(0);\n  float w = abs(q.w);\n  if (abs(q.x)>w) side.x = q.x>q.w ? 1.0 : -1.0;\n  if (abs(q.y)>w) side.y = q.y>q.w ? 1.0 : -1.0;\n  if (abs(q.z)>w) side.z = q.z>q.w ? 1.0 : -1.0;\n  return side;\n}\n\nvoid snip(in float px, in float py, in float qx, in float qy, inout float t0, inout float t1)\n{\n  const float small_float = 1e-10;\n\n  float t0_local = 0.0;\n  float t1_local = 1.0;\n\n  // check which side of line P and Q are with respect to x=y\n  // in this case (+) means x-y>0\n  bool positive_p = (px - py) > 0.0;\n  bool positive_q = (qx - qy) > 0.0;\n  if (positive_p != positive_q)\n  {\n    // snip against x=y line\n    // (1-t)P + tQ = R = (c,c)\n    // (1-t)Px + tQx = (1-t)Py +tQy\n    // t = (Px-Py) / (Px-Py-Qx+Qy)\n    float denom = px - py - qx + qy;\n    if (abs(denom) > small_float) {\n      float posxy_t = (px - py) / denom;\n      if (positive_p) //reduce t1\n        t1_local = posxy_t < t1_local ? posxy_t : t1_local;\n      else // increase t0\n        t0_local = posxy_t > t0_local ? posxy_t : t0_local;\n    }\n  }\n  // check which side of line P and Q are with respect to x=-y\n  // in this case (+) means X+y>0\n  positive_p = (px + py) > 0.0;\n  positive_q = (qx + qy) > 0.0;\n  if (positive_p != positive_q) {\n    // snip against x=-y line\n    // (1-t)P + tQ = R = (c,-c)\n    // (1-t)Px + tQx = -((1-t)Py +tQy)\n    // t = (Px+Py) / (Px+Py-Qx-Qy)\n    float denom = px + py - qx - qy;\n    if (abs(denom) > small_float) {\n      float negxy_t = (px + py) / denom;\n      if (positive_p) //reduce t1\n        t1_local = negxy_t < t1_local ? negxy_t : t1_local;\n      else // increase t0\n        t0_local = negxy_t > t0_local ? negxy_t : t0_local;\n    }\n  }\n  if (t0_local >= t1_local)\n    return;\n  if (t0_local > t0)\n    t0 = t0_local;\n  if (t1_local < t1)\n    t1 = t1_local;\n}\n\nvoid SnipToFrustum(in vec4 start, in vec4 end, in vec3 start_side, in vec3 end_side, out float t0, out float t1)\n{\n  t0 = 0.0;\n  t1 = 1.0;\n\n  if( start_side.x != 0.0 || end_side.x != 0.0)\n  {\n    snip(start.w, start.x, end.w, end.x, t0, t1);\n  }\n  if( start_side.y != 0.0 || end_side.y != 0.0)\n  {\n    snip(start.w, start.y, end.w, end.y, t0, t1);\n  }\n  if( start_side.z != 0.0 || end_side.z != 0.0)\n  {\n    snip(start.w, start.z, end.w, end.z, t0, t1);\n  }\n}\nvoid main()\n{\n  fs_color = color;\n\n  vec4 clip_position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vec4 clip_next = projectionMatrix * modelViewMatrix * vec4(end, 1.0);\n#ifdef NO_CLIP_Z\n  clip_position.z = 0.0;\n  clip_next.z = 0.0;\n#endif\n  vec3 start_side = ClippingSideFlag(clip_position);\n  vec3 end_side = ClippingSideFlag(clip_next);\n  float t0 = 0.0;\n  float t1 = 1.0;\n  SnipToFrustum(clip_position, clip_next, start_side, end_side, t0, t1);\n  vec3 world_dir = end - position;\n  vec3 clipped_start = position + world_dir * t0;\n  vec3 clipped_end = position + world_dir * t1;\n  clip_position = projectionMatrix * modelViewMatrix * vec4(clipped_start, 1.0);\n  clip_next = projectionMatrix * modelViewMatrix * vec4(clipped_end, 1.0);\n\n\n  vec2 screen0 = ClipToScreen(clip_position);\n  vec2 screen1 = ClipToScreen(clip_next);\n  vec2 dir = screen1 - screen0;\n  dir = normalize(dir);\n  vec2 offset_screen_point = screen0 + (dir * 0.5 * thickness);\n  vec2 screen = RotatePoint90(offset_screen_point, side>0.0, screen0);\n  vec2 s2c = ScreenToClip(screen);\n  clip_position.x = s2c.x*clip_position.w;\n  clip_position.y = s2c.y*clip_position.w;\n#ifdef NO_CLIP_Z\n  clip_position.z = 0.0;\n#else\n  float z = clip_position.z / clip_position.w;\n  z -= 0.001;\n  clip_position.z = z * clip_position.w;\n#endif\n  // clip_position.w = 1.0;\n  gl_Position = clip_position;\n}\n",n="\nvarying vec4 fs_color;\n\nvoid main() {\n  gl_FragColor = fs_color;\n}\n";e&&(t="#define NO_CLIP_Z\n    "+t,n="#define NO_CLIP_Z\n    "+n);let i=new l["H"]({uniforms:{viewport_size:{type:"vec2",value:v.viewportSize}},vertexShader:t,fragmentShader:n,depthWrite:!e,depthTest:!e});return i}function u(e){let t=!e._depthTesting;return e._canBeLineSegments?d(t,e._colors):h(t)}class p{static createThreeObjectFromLines(e,t,n,i){let r=new p(i);return r.addLines(e,t,n),r.createThreeObject()}constructor(e){this._canBeLineSegments=!0,this._starts=[],this._ends=[],this._thicknesses=[],this._sides=[],this._colors=[],this._indices=[],this._depthTesting=e}addLine(e,t,n,i){if(Array.isArray(e)&&(e=new l["M"](e[0],e[1],e[2])),Array.isArray(t)&&(t=new l["M"](t[0],t[1],t[2])),this._canBeLineSegments&&(1!==i||this._colors.length>0&&!this._colors[0].equals(n))){let e=new p;e._canBeLineSegments=!1;for(let t=0;t<this._starts.length;t+=2){let n=this._starts[t],i=this._starts[t+1];e.addLine(n,i,this._colors,this._thicknesses)}this._canBeLineSegments=!1,this._starts=e._starts,this._ends=e._ends,this._thicknesses=e._thicknesses,this._sides=e._sides,this._colors=e._colors,this._indices=e._indices}if(this._canBeLineSegments)return this._starts=this._starts.concat([e,t]),this._colors=n,void(this._thicknesses=1);this._starts=this._starts.concat([e,t,t,e]),this._ends=this._ends.concat([t,e,e,t]),this._sides=this._sides.concat([1,-1,1,-1]),this._colors=this._colors.concat([n,n,n,n]),this._thicknesses=this._thicknesses.concat([i,i,i,i]);let r=this._starts.length-4;this._indices=this._indices.concat([r,r+1,r+2,r+2,r+3,r])}addLines(e,t,n){for(let i=0;i<e.length;i+=2){let r=e[i],s=e[i+1];this.addLine(r,s,t,n)}}addPolyline(e,t,n){let i=e.length;if(!(i<2))for(let r=0;r<i-1;r++)this.addLine(e[r],e[r+1],t,n)}createThreeObject(){let e=c(this),t=u(this);return this._canBeLineSegments?new l["p"](e,t):new l["v"](e,t)}}var f=p;function m(){let e=new l["c"],t=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);return e.setAttribute("position",new l["b"](t,3)),e.setIndex([0,1,2,0,2,3]),e}function g(){let e="\nvarying vec2 tc;\nvoid main() {\n  tc = vec2((position.x + 1.0) * 0.5, (position.y + 1.0) * 0.5);\n  gl_Position = vec4(position, 1.0);\n}\n",t="\nuniform sampler2D imageLeft;\nuniform sampler2D imageRight;\nuniform float horizontalPosition;\nuniform int compareMode;\nvarying vec2 tc;\nvoid main() {\n  vec4 color1 = texture2D(imageLeft, tc);\n  vec4 color2 = texture2D(imageRight, tc);\n  // compareMode: 0 (swipe), 1 (blend)\n  if (compareMode == 0) {\n    gl_FragColor = texture2D(imageLeft, tc);\n    if (tc.x > horizontalPosition)\n      gl_FragColor = texture2D(imageRight, tc);\n  } else {\n    gl_FragColor = mix(color1, color2, horizontalPosition);\n  }\n}\n",n=new l["H"]({uniforms:{imageLeft:{type:"sampler2D",value:null},imageRight:{type:"sampler2D",value:null},horizontalPosition:{type:"float",value:1},compareMode:{type:"int",value:0}},vertexShader:e,fragmentShader:t,depthWrite:!1,depthTest:!1,transparent:!0});return n}class y{static createThreeObject(){let e=m(),t=g();return new l["v"](e,t)}}function w(e,t){let n=ne.getRhino3dm(),i=t,r=[],s=[];if(e instanceof n.LineCurve)return[e.pointAtStart,e.pointAtEnd];if(e instanceof n.PolylineCurve){i=e.pointCount;for(let t=0;t<i;t++)r.push(e.point(t));return r}if(e instanceof n.PolyCurve){let t=e.segmentCount;for(let n=0;n<t;n++){let t=e.segmentCurve(n),s=w(t,i);r=r.concat(s),t.delete()}return r}e instanceof n.NurbsCurve&&1===e.degree&&console.info("degree 1 curve");let o=e.domain,a=i-1;for(let c=0;c<i;c++){let t=o[0]+c/a*(o[1]-o[0]);if(t===o[0]||t===o[1]){s.push(t);continue}let n=e.tangentAt(t),i=new l["M"](n[0],n[1],n[2]),r=e.tangentAt(s.slice(-1)[0]),d=new l["M"](r[0],r[1],r[2]),h=i.angleTo(d);h<.1||s.push(t)}return r=s.map(t=>e.pointAt(t)),r}function b(e,t){let n=e.materials(),i=n.findFromAttributes(t),r=0;return i&&(r=i.id,i.delete()),n.delete(),r}let _={createGrid(e=1,t=70,n=5){const i=-t*e,r=i,s=t*e,o=s;let a=new l["n"],c=[],d=[];for(let u=-t;u<=t;u++){let t=u*e,a=u*e;0!==u?u%n===0?(d.push(new l["M"](t,r,0)),d.push(new l["M"](t,o,0)),d.push(new l["M"](i,a,0)),d.push(new l["M"](s,a,0))):(c.push(new l["M"](t,r,0)),c.push(new l["M"](t,o,0)),c.push(new l["M"](i,a,0)),c.push(new l["M"](s,a,0))):(d.push(new l["M"](0,r,0)),d.push(new l["M"](0,0,0)),d.push(new l["M"](i,0,0)),d.push(new l["M"](0,0,0)))}a.add(f.createThreeObjectFromLines(c,new l["f"](147/255,.6,160/255),1,!1)),a.add(f.createThreeObjectFromLines(d,new l["f"](129/255,134/255,140/255),1,!1));let h=new f(!1);return h.addLine(new l["M"](0,0,0),new l["M"](s,0,0),new l["f"](150/255,75/255,75/255),2),h.addLine(new l["M"](0,0,0),new l["M"](0,o,0),new l["f"](75/255,150/255,75/255),2),a.add(h.createThreeObject()),a},meshWiresToThreejs(e,t){let n=e.topologyEdges(),i=n.count,r=new Float32Array(2*i*3);for(let l=0;l<i;l++){let e=n.edgeLine(l);r[6*l]=e.from[0],r[6*l+1]=e.from[1],r[6*l+2]=e.from[2],r[6*l+3]=e.to[0],r[6*l+4]=e.to[1],r[6*l+5]=e.to[2]}n.delete();let s=new l["c"];s.setAttribute("position",new l["b"](r,3));let o=new l["f"](t.r/255,t.g/255,t.b/255),a=new l["o"]({color:o}),c=new l["p"](s,a);return c.userData["surfaceWires"]=!0,c},meshToThreejs(e,t,n){let i=e.textureCoordinates();if(0===i.count){let t=ne.getRhino3dm(),n=new t.Sphere([0,0,0],1e3),i=t.TextureMapping.createSphereMapping(n);e.setTextureCoordinates(i,null,!1)}i.delete();let r=new l["d"];var s=r.parse(e.toThreejsJSON());let o=new l["f"](t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(o.r=1,o.g=1,o.b=1);let a=new l["w"]({color:o,side:l["i"]}),c=new l["v"](s,a);return c.userData["diffuse"]=o,c.userData["materialId"]=n,c},createThreeGeometry(e,t,n){let i=ne.getRhino3dm(),r=[],s=t.drawColor(n);const o=e.objectType;switch(o){case i.ObjectType.Point:{let t=new l["E"]({color:s}),n=new l["m"],i=e.location;n.vertices.push(new l["M"](i[0],i[1],i[2])),r.push([new l["D"](n,t),e.getBoundingBox()])}break;case i.ObjectType.PointSet:{let t=new l["E"]({color:s}),n=new l["m"],i=e.count;for(let r=0;r<i;r++){let t=e.pointAt(r);n.vertices.push(new l["M"](t[0],t[1],t[2]))}r.push([new l["D"](n,t),e.getBoundingBox()])}break;case i.ObjectType.Curve:{let t=w(e,100),n=new f(!0),i=new l["f"](s.r/255,s.g/255,s.b/255);n.addPolyline(t,i,1.5),r.push([n.createThreeObject(),e.getBoundingBox()])}break;case i.ObjectType.Surface:console.warn("TODO: Implement surface");break;case i.ObjectType.Brep:{let o=b(n,t),a=e.faces();for(let e=0;e<a.count;e++){let t=a.get(e),n=t.getMesh(i.MeshType.Any);if(n){let e=this.meshToThreejs(n,s,o);r.push([e,n.getBoundingBox()]),n.delete()}t.delete()}a.delete();let c=new l["n"];c.userData["surfaceWires"]=!0;let d=e.edges();for(let e=0;e<d.count;e++){let t=d.get(e),n=w(t,100),i=new f(!0),r=new l["f"](s.r/255,s.g/255,s.b/255);i.addPolyline(n,r,1.5),c.add(i.createThreeObject())}r.push([c,e.getBoundingBox()])}break;case i.ObjectType.Mesh:{let i=b(n,t),o=this.meshToThreejs(e,s,i);r.push([o,e.getBoundingBox()]);let l=this.meshWiresToThreejs(e,s);r.push([l,e.getBoundingBox()])}break;case i.ObjectType.Light:console.warn("TODO: Implement light");break;case i.ObjectType.Annotation:console.warn("TODO: Implement annotation");break;case i.ObjectType.InstanceReference:{let t=e.parentIdefId,s=e.xform.toFloatArray(!0),o=null,a=new l["n"],c=new l["u"];c.set(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15]),a.applyMatrix(c);let d=n.instanceDefinitions(),h=n.objects(),u=d.findId(t),p=u.getObjectIds();p.forEach(t=>{let r=h.findId(t),s=r.geometry(),l=r.attributes(),c=this.createThreeGeometry(s,l,n);c.forEach(t=>{let n=t[1];n.transform(e.xform),o=null==o?n:i.BoundingBox.union(o,n),a.add(t[0])})}),r.push([a,o]),h.delete(),d.delete()}break;case i.ObjectType.TextDot:let o=document.createElement("div");o.style.fontFamily=e.fontFace,o.style.fontSize=e.fontHeight+"px",o.style.marginTop="-1em",o.style.color="#FFF",o.style.padding="2px",o.style.paddingRight="5px",o.style.paddingLeft="5px",o.style.borderRadius="5px",o.style.background=`rgba(${s.r},${s.g},${s.b},${s.a})`,o.textContent=e.text;let c=new a["a"](o),d=e.point;c.position.set(d[0],d[1],d[2]),r.push([c,null]);break;case i.ObjectType.Hatch:console.warn("TODO: Implement hatch");break;case i.ObjectType.SubD:{e.subdivide(3);let o=i.Mesh.createFromSubDControlNet(e),l=b(n,t),a=this.meshToThreejs(o,s,l);r.push([a,e.getBoundingBox()]),o.delete()}break;case i.ObjectType.ClipPlane:let h=e.normalAt(0,0),u=e.pointAt(0,0),p=new l["C"](new l["M"](h[0],h[1],h[2]),0);p.translate(new l["M"](u[0],u[1],u[2])),r.push([p,null]);break;case i.ObjectType.Extrusion:{let o=e.getMesh(i.MeshType.Any);if(o){let e=b(n,t),i=this.meshToThreejs(o,s,e);r.push([i,o.getBoundingBox()]),o.delete()}}break;default:break}return r},createThreeMaterial(e,t){let n=null,i=ne.getRhino3dm(),r=new l["K"],s=e.physicallyBased();if(s.supported){let s=[i.TextureType.PBR_BaseColor,i.TextureType.PBR_Metallic,i.TextureType.PBR_Roughness];s.forEach(s=>{let o=e.getTexture(s);if(o){let e=t.getEmbeddedFileAsBase64(o.fileName);e&&(n||(n=new l["x"]),s===i.TextureType.PBR_BaseColor&&(n.map=r.load("data:image/png;base64,"+e)),s===i.TextureType.PBR_Metallic&&(n.metalnessMap=r.load("data:image/png;base64,"+e)),s===i.TextureType.PBR_Roughness&&(n.roughnessMap=r.load("data:image/png;base64,"+e))),o.delete()}})}if(n){let e=new l["g"];e.setPath("cubemaps/skyboxsun25deg/");let t=e.load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"]);n.envMap=t,n.metalness=s.metallic,n.roughness=s.roughness,n.normalScale.x=1,n.normalScale.y=1}return s.delete(),n},createScreenQuad(){return y.createThreeObject()},viewportSize:new l["L"](0,0)};var v=_,x=n("cbaf"),M=(n("ddb0"),n("b669")),T=n.n(M),P=n("f763"),O=n.n(P),S=n("4721"),j=new WeakMap,C=new WeakMap,L=new WeakMap,k=new WeakMap,B=new WeakMap,z=new WeakMap,E=new WeakMap,F=new WeakMap,D=new WeakMap,A=new WeakMap,R=new WeakMap;class W{constructor(e){j.set(this,{writable:!0,value:null}),C.set(this,{writable:!0,value:null}),L.set(this,{writable:!0,value:null}),k.set(this,{writable:!0,value:null}),B.set(this,{writable:!0,value:null}),z.set(this,{writable:!0,value:[0,0]}),E.set(this,{writable:!0,value:new l["G"]}),F.set(this,{writable:!0,value:[null,null]}),D.set(this,{writable:!0,value:null}),A.set(this,{writable:!0,value:new l["G"]}),R.set(this,{writable:!0,value:null}),console.log("create pipeline"),l["z"].DefaultUp=new l["M"](0,0,1),O()(this,j,new l["O"]({antialias:!0})),T()(this,j).setPixelRatio(window.devicePixelRatio),T()(this,j).setSize(e.clientWidth,e.clientHeight),O()(this,B,e),T()(this,B).appendChild(T()(this,j).domElement),O()(this,C,new a["b"]),T()(this,C).domElement.id="labels",T()(this,C).setSize(e.clientWidth,e.clientHeight),T()(this,C).domElement.style.position="absolute",T()(this,C).domElement.style.top=0,T()(this,C).domElement.style.pointerEvents="none",e.appendChild(T()(this,C).domElement),O()(this,L,new l["B"](30,e.clientWidth/e.clientHeight,1,1e3)),T()(this,L).position.z=40,O()(this,k,new S["a"](T()(this,L),T()(this,j).domElement)),T()(this,k).screenSpacePanning=!0,T()(this,k).addEventListener("change",()=>this.updateFrustum()),O()(this,D,v.createScreenQuad()),T()(this,A).add(T()(this,D))}drawFrameBuffer(e,t,n,i,r){null==n&&(r=100);let s=T()(this,B).clientWidth,o=T()(this,B).clientHeight;const l=T()(this,z)[0]!==T()(this,B).clientWidth||T()(this,z)[1]!==T()(this,B).clientHeight;O()(this,z,[T()(this,B).clientWidth,T()(this,B).clientHeight]),l&&(T()(this,L).aspect=T()(this,B).clientWidth/T()(this,B).clientHeight,T()(this,L).updateProjectionMatrix(),T()(this,j).setSize(T()(this,B).clientWidth,T()(this,B).clientHeight),T()(this,C).setSize(T()(this,B).clientWidth,T()(this,B).clientHeight)),T()(this,k).update(),v.viewportSize.width=s,v.viewportSize.height=o,e.clipping?T()(this,j).clippingPlanes=t.clippingPlanes:T()(this,j).clippingPlanes=[],T()(this,j).autoClear=!1,T()(this,j).sortObjects=!1,this.drawBackground(e),this.drawMiddlegroundToTexture(0,t.three.middleground),T()(this,D).material.uniforms.imageLeft.value=T()(this,F)[0].texture;const a=r/100;T()(this,D).material.uniforms.horizontalPosition.value=a,T()(this,D).material.uniforms.compareMode.value=i,null!=n?(null==n.syncCamera&&(n.syncCamera=T()(this,L).clone(),n.three.middleground.add(n.syncCamera)),n.syncCamera.copy(T()(this,L),!1),this.drawMiddlegroundToTexture(1,n.three.middleground),T()(this,D).material.uniforms.imageRight.value=T()(this,F)[1].texture):T()(this,D).material.uniforms.imageRight.value=T()(this,F)[0].texture,T()(this,j).render(T()(this,A),T()(this,L))}drawBackground(e){if(e.backgroundStyle===x["a"].backgroundModes[0])T()(this,E).background=new l["f"](e.backgroundColor);else if(e.backgroundStyle===x["a"].backgroundModes[1]){const t=document.createElement("canvas");t.width=128,t.height=128;let n=t.getContext("2d"),i=n.createLinearGradient(0,0,0,t.height);i.addColorStop(1,e.backgroundGradientTop),i.addColorStop(.1,e.backgroundGradientBottom),n.fillStyle=i,n.fillRect(0,0,t.width,t.height),T()(this,E).background=new l["e"](t)}null==T()(this,E).grid&&(T()(this,E).grid=v.createGrid(),T()(this,E).add(T()(this,E).grid)),T()(this,E).grid.visible=e.showGrid,T()(this,j).render(T()(this,E),T()(this,L))}drawMiddlegroundToTexture(e,t){null==T()(this,F)[e]&&(T()(this,F)[e]=new l["N"](T()(this,z)[0],T()(this,z)[1])),T()(this,F)[e].width===T()(this,z)[0]&&T()(this,F)[e].height===T()(this,z)[1]||T()(this,F)[e].setSize(2*T()(this,z)[0],2*T()(this,z)[1]),T()(this,j).setRenderTarget(T()(this,F)[e]),T()(this,j).setClearColor(new l["f"](0,0,0),0),T()(this,j).clear(!0,!0),T()(this,j).render(t,T()(this,L)),T()(this,j).setRenderTarget(null)}boxCorners(e){return[new l["M"](e.min.x,e.min.y,e.min.z),new l["M"](e.min.x,e.min.y,e.max.z),new l["M"](e.min.x,e.max.y,e.min.z),new l["M"](e.min.x,e.max.y,e.max.z),new l["M"](e.max.x,e.min.y,e.min.z),new l["M"](e.max.x,e.min.y,e.max.z),new l["M"](e.max.x,e.max.y,e.min.z),new l["M"](e.max.x,e.max.y,e.max.z)]}updateFrustum(){if(ne.viewModel().perspectiveCamera){let e=ne.visibleObjectsBoundingBox(),t=this.boxCorners(e),n=new l["M"](0,0,-1);n.applyQuaternion(T()(this,L).quaternion);let i=new l["C"](n,0);i.translate(T()(this,L).position);let r=t.map(e=>i.distanceToPoint(e));T()(this,L).near=Math.max(.1,Math.min(...r)),T()(this,L).far=Math.max(...r),T()(this,L).updateProjectionMatrix()}}setPanMode(e){e?(T()(this,k).mouseButtons.LEFT=l["s"].PAN,T()(this,k).touches.ONE=l["J"].PAN):(T()(this,k).mouseButtons.LEFT=l["s"].ROTATE,T()(this,k).touches.ONE=l["J"].ROTATE)}zoomExtents(e){let t=ne.getRhino3dm(),n=ne.viewModel().perspectiveCamera?t.ViewportInfo.defaultPerspective():t.ViewportInfo.defaultTop(),i=new l["L"](0,0);T()(this,j).getSize(i),n.screenPort=[0,0,i.x,i.y];let r=ne.visibleObjectsBoundingBox(),s=new t.BoundingBox(r.min.x,r.min.y,r.min.z,r.max.x,r.max.y,r.max.z),o=s.center,a=s.max[0]-s.min[0],c=s.max[1]-s.min[1],d=s.max[2]-s.min[2];s.inflate(.2*a,.2*c,.2*d);let h=a,u=h*i.y/i.x;if(n.setFrustum(-h/2,h/2,-u/2,u/2,.1,1e3),n.extents(50*Math.PI/180,s),s.delete(),e){ne.getActiveModel().three.middleground.remove(T()(this,L));let e=n.getFrustum();ne.viewModel().perspectiveCamera?O()(this,L,new l["B"](30,i.x/i.y,e.near,e.far)):(O()(this,L,new l["A"](e.left,e.right,e.top,e.bottom,e.near,e.far)),T()(this,L).up.set(n.cameraUp[0],n.cameraUp[1],n.cameraUp[2])),T()(this,k).object=T()(this,L);let t=new l["h"](ne.viewModel().lightColor);t.position.set(0,0,1),T()(this,L).add(t),ne.getActiveModel().three.middleground.add(T()(this,L))}let p=n.cameraLocation;T()(this,L).position.set(p[0],p[1],p[2]),T()(this,L).updateProjectionMatrix(),T()(this,k).target.set(o[0],o[1],o[2]),n.delete()}}var I=n("9523"),q=n.n(I),G=(n("bf19"),n("5a15"));let H={readFile(e,t,n){let i=new G["a"],r=i.parse(t),s=new n.File3dm,o=new n.Layer;o.name="Default",s.layers().add(o);let l=new n.ObjectAttributes;return l.layersIndex=0,r.children.forEach(e=>{if("Mesh"===e.type){let t=n.Mesh.createFromThreejsJSON(e.geometry.toJSON());e.material.color?(l.colorSource=n.ObjectColorSource.ColorFromObject,l.objectColor={r:255*e.material.color.r,g:255*e.material.color.g,b:255*e.material.color.b,a:255}):l.colorSource=n.ObjectColorSource.ColorFromLayer,s.objects().addMesh(t,l)}}),s}};var N=H;let Q={readFile(e,t,n){let i=n.DracoCompression.decompressByteArray(t),r=new n.File3dm,s=new n.Layer;s.name="Default",r.layers().add(s);let o=new n.ObjectAttributes;return o.layersIndex=0,r.objects().addMesh(i,o),r}};var V=Q,J=n("21cb");let Z={readFile(e,t,n){let i=new J["a"],r=i.parse(t),s=new n.File3dm,o=new n.Layer;o.name="Default",s.layers().add(o);let l=new n.ObjectAttributes;l.layersIndex=0;let a=n.Mesh.createFromThreejsJSON(r.toJSON());return s.objects().addMesh(a,l),s}};var $=Z;function U(e,t,n){t.forEach(t=>{e.layers.hasOwnProperty(t)||(e.layers[t]={visible:!0,layers:{}}),e=e.layers[t]}),e.visible=n.visible}function X(e){let t=[],n=Object.getOwnPropertyNames(e.layers);return n.forEach(n=>{let i={label:n,visible:e.layers[n].visible},r=X(e.layers[n]);r.length>0&&(i.children=r),t.push(i)}),t}var Y=new WeakMap;class K{constructor(e,t){q()(this,"rhinoDoc",null),q()(this,"layers",[]),q()(this,"three",{middleground:null,foreground:null}),q()(this,"syncCamera",null),q()(this,"clippingPlanes",[]),Y.set(this,{writable:!0,value:null}),q()(this,"name",""),this.rhinoDoc=e,this.name=t,this.three.middleground=new l["G"],this.three.foreground=new l["G"];let n=e.layers(),i=n.count(),r={layers:{},visible:!0};for(let s=0;s<i;s++){let e=n.get(s),t=e.fullPath,i=t.split("::");U(r,i,e),e.delete()}n.delete(),this.layers=X(r),this.buildSceneHelper()}buildSceneHelper(){const e=this.rhinoDoc;let t=e.objects();for(let n=0;n<t.count;n++){let i=t.get(n);if(null==i)continue;let r=i.geometry(),s=i.attributes();if(s.isInstanceDefinitionObject)continue;let o=e.layers().get(s.layerIndex),c=v.createThreeGeometry(r,s,e);c.forEach(e=>{let t=e[0],n=e[1];if(t.fullLayerPath=o.fullPath,n){let e=new l["M"](n.min[0],n.min[1],n.min[2]),i=new l["M"](n.max[0],n.max[1],n.max[2]);t.boundingBox=new l["a"](e,i),n.delete()}switch(t.constructor){case a["a"]:this.three.foreground.add(t);break;case l["C"]:this.clippingPlanes.push(t);break;default:this.three.middleground.add(t);break}}),i.delete(),r.delete(),s.delete()}t.delete()}static create(e,t,n){let i=null;if(i=e.endsWith(".obj")?N.readFile(e,t,n):e.endsWith(".drc")?V.readFile(e,t,n):e.endsWith(".ply")?$.readFile(e,t,n):n.File3dm.fromByteArray(t),null!=i){const t=new K(i,e);return t}return null}dispose(){null!=this.rhinoDoc&&this.rhinoDoc.delete(),this.rhinoDoc=null,this.three.middleground&&(this.three.middleground.dispose(),this.three.middleground=null),this.three.foreground&&(this.three.foreground.dispose(),this.three.foreground=null)}getSceneObjectDictionary(){if(null==T()(this,Y)){let e={};this.three.foreground.children.forEach(t=>{let n=t.fullLayerPath.split("::")[0];e[n]||(e[n]=[]),e[n].push(t)}),this.three.middleground.children.forEach(t=>{let n=t.fullLayerPath.split("::")[0];e[n]||(e[n]=[]),e[n].push(t)}),O()(this,Y,e)}return T()(this,Y)}getSceneObjectsOnLayer(e){const t=this.getSceneObjectDictionary();return t[e]}}let ee=null,te={docExists:!1,compareDocExists:!1,title:"rview WIP",expanded:["Layers"],layers:[],perspectiveCamera:!0,currentMaterialStyle:"Basic",materialOptions:["Basic","PBR: Carbon Fiber","PBR: Chipped Paint Metal","PBR: Scuffed Plastic","PBR: Streaked Metal"],displayMode:null,comparePosition:50,compareMode:0};class ne{static init(e,t,n){if(ne.setActiveDisplayMode("Shaded",!1),null==o()(ne,ne,ie)){let i=e();console.log("start loading rhino3dm"),t(),i.then(e=>{if(r()(ne,ne,ie,e),n(),console.log("rhino3dm loaded"),null!=ee){let e=ee[0],t=ee[1];ee=null,ne.openFile(e,t)}})}}static registerWebGlElement(e){r()(ne,ne,se,e)}static openFile(e,t,n=!1){if(null==o()(ne,ne,ie))return ee=[e,t],!1;const i=K.create(e,t,o()(ne,ne,ie));if(null==i)return alert("Invalid document"),!1;if(null!=o()(ne,ne,le)&&o()(ne,ne,le).dispose(),r()(ne,ne,le,null),n&&null!=o()(ne,ne,oe)?(r()(ne,ne,le,i),te.compareDocExists=!0,te.title=o()(ne,ne,oe).name+" | "+o()(ne,ne,le).name):(te.title=e,null!=o()(ne,ne,oe)&&o()(ne,ne,oe).dispose(),r()(ne,ne,oe,i)),te.docExists=!0,te.compareDocExists=null!=o()(ne,ne,le),te.layers=o()(ne,ne,oe).layers,null!=o()(ne,ne,le)){let e=[];for(let t=0;t<o()(ne,ne,le).layers.length;t++){let n=!0;for(let e=0;e<te.layers.length;e++)if(te.layers[e].label===o()(ne,ne,le).layers[t].label){n=!1;break}n&&e.push(o()(ne,ne,le).layers[t])}te.layers=te.layers.concat(e)}let s=document.getElementById("labels");return null!=s&&(s.innerHTML=""),ne.updateVisibility(),ne.getDisplayPipeline().zoomExtents(!0),requestAnimationFrame(()=>ne.renderLoop()),!0}static getDisplayPipeline(){if(null==o()(ne,ne,re)){if(""===o()(ne,ne,se))throw new Error("no element defined for WebGL");r()(ne,ne,re,new W(document.getElementById(o()(ne,ne,se))))}return o()(ne,ne,re)}static getRhino3dm(){return o()(ne,ne,ie)}static viewModel(){return te}static updateVisibility(){te.layers.forEach(e=>{ne.getSceneObjectsOnLayer(e.label).forEach(t=>{t.visible=e.visible,t.visible&&"Mesh"===t.type&&(t.visible=te.displayMode.showSurfaceMeshes),t.visible&&t.userData["surfaceWires"]&&(t.visible=te.displayMode.showSurfaceWires)})})}static setActiveDisplayMode(e,t=!0){null==o()(ne,ne,ae)&&r()(ne,ne,ae,x["a"].defaultModes());for(let n=0;n<o()(ne,ne,ae).length;n++)if(o()(ne,ne,ae)[n].name===e){te.displayMode=o()(ne,ne,ae)[n];break}t&&ne.updateVisibility()}static applyMaterial(e){te.layers.forEach(t=>{let n=ne.getSceneObjectsOnLayer(t.label);null!=n&&n.forEach(t=>{if("Mesh"===t.type&&t.userData["diffuse"])if(t.material&&(t.material.dispose(),t.material=null),null==e){let e=t.userData["diffuse"];t.material=new l["w"]({color:e,side:l["i"]}),te.displayMode.transparency&&(t.material.opacity=te.displayMode.transparency,t.material.transparent=!0)}else t.material=e})})}static applyMaterial2(e){console.log("apply materials"),te.layers.forEach(t=>{let n=ne.getSceneObjectsOnLayer(t.label);null!=n&&n.forEach(t=>{if("Mesh"===t.type&&t.userData["diffuse"]){if(t.material&&(t.material.dispose(),t.material=null),e){let e=t.userData["materialId"],n=o()(ne,ne,oe).rhinoDoc.materials(),i=n.findId(e);t.material=v.createThreeMaterial(i,o()(ne,ne,oe).rhinoDoc),i.delete(),n.delete()}if(null==t.material){let e=t.userData["diffuse"];t.material=new l["w"]({color:e,side:l["i"]}),te.displayMode.transparency&&(t.material.opacity=te.displayMode.transparency,t.material.transparent=!0)}}})})}static getActiveModel(){return o()(ne,ne,oe)}static getSceneObjectsOnLayer(e){let t=[];if(null!=o()(ne,ne,oe)){const n=o()(ne,ne,oe).getSceneObjectsOnLayer(e);null!=n&&(t=t.concat(n))}if(null!=o()(ne,ne,le)){const n=o()(ne,ne,le).getSceneObjectsOnLayer(e);null!=n&&(t=t.concat(n))}return t}static visibleObjectsBoundingBox(){let e=null;return te.layers.forEach(t=>{if(!t.visible)return;let n=ne.getSceneObjectsOnLayer(t.label);null!=n&&n.forEach(t=>{null!=t.boundingBox&&(null==e?e=t.boundingBox.clone():e.union(t.boundingBox))})}),e}static renderLoop(){requestAnimationFrame(()=>ne.renderLoop()),null!=o()(ne,ne,re)&&o()(ne,ne,re).drawFrameBuffer(te.displayMode,o()(ne,ne,oe),o()(ne,ne,le),te.compareMode,te.comparePosition)}}var ie={writable:!0,value:null},re={writable:!0,value:null},se={writable:!0,value:""},oe={writable:!0,value:null},le={writable:!0,value:null},ae={writable:!0,value:x["a"].defaultModes()}},cbaf:function(e,t,n){"use strict";function i(){let e=new l("Wireframe");return e.showSurfaceMeshes=!1,e}function r(){let e=new l("Shaded");return e}function s(){let e=new l("Ghosted");return e.transparency=.5,e}function o(){let e=new l("Rendered");return e.showGrid=!1,e.showSurfaceWires=!1,e}class l{constructor(e=null){this.name=e,this.showGrid=!0,this.backgroundStyle="Single Color",this.backgroundColor="rgb(157,163,170)",this.backgroundGradientTop="rgb(54,109,168)",this.backgroundGradientBottom="rgb(165,165,165)",this.lightColor="rgb(240,240,240)",this.showSurfaceWires=!0,this.showSurfaceMeshes=!0,this.clipping=!0,this.defaultModes=()=>{let e=[];return e.push(i()),e.push(r()),e.push(s()),e.push(o()),e}}}let a={defaultModes:()=>(new l).defaultModes(),backgroundModes:["Single Color","2 Color Gradient"]};t["a"]=a}});